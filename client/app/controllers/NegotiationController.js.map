{"version":3,"sources":["../../src/controllers/NegotiationController.js"],"names":["NegotiationsView","Negotiations","MessageView","Message","NegotiationService","getNegotiationDAO","getExceptionMessage","Negotiation","DateConverter","Bind","NegotiationController","constructor","$","document","querySelector","bind","_inputDate","_inputQuantity","_inputValue","_negotiations","_message","_service","_init","dao","listAll","then","negotiations","forEach","negotiation","add","catch","err","text","event","preventDefault","_createNegotiation","_clearForm","console","log","DateInvalidException","message","value","focus","toDate","parseInt","parseFloat","delete","deleteAll","clear","importNegotiations","object","getNegotiationsByPeriod","filter","newNegotiation","toArray","some","exists","equals"],"mappings":"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","file":"NegotiationController.js","sourcesContent":["import NegotiationsView from \"../views/NegotiationsView\";\r\nimport Negotiations from \"../models/negotiation/Negotiations\";\r\nimport MessageView from \"../views/MessageView\";\r\nimport Message from \"../models/Message\";\r\nimport NegotiationService from \"../services/NegotiationService\";\r\nimport { getNegotiationDAO } from \"../utils/DaoFactory\";\r\nimport getExceptionMessage from \"../utils/exceptions/ApplicationException\";\r\nimport Negotiation from \"../models/negotiation/Negotiation\";\r\nimport DateConverter from \"../utils/DateConverter\";\r\nimport Bind from \"../utils/Bind\";\r\n\r\nexport default class NegotiationController {\r\n\tconstructor() {\r\n\t\tconst $ = document.querySelector.bind(document);\r\n\t\tthis._inputDate = $(\"#date\");\r\n\t\tthis._inputQuantity = $(\"#quantity\");\r\n\t\tthis._inputValue = $(\"#value\");\r\n\r\n\t\t//\tcreating a new Proxy with support of fabric\r\n\t\tthis._negotiations = new Bind(\r\n\t\t\tnew Negotiations(),\r\n\t\t\tnew NegotiationsView(\"#negotiations\"),\r\n\t\t\t\"add\",\r\n\t\t\t\"clear\"\r\n\t\t);\r\n\r\n\t\tthis._message = new Bind(\r\n\t\t\tnew Message(),\r\n\t\t\tnew MessageView(\"#messageView\"),\r\n\t\t\t\"text\"\r\n\t\t);\r\n\r\n\t\tthis._service = new NegotiationService();\r\n\r\n\t\tthis._init();\r\n\t}\r\n\r\n\tasync _init() {\r\n\t\tconst dao = await getNegotiationDAO();\r\n\t\tawait dao\r\n\t\t\t.listAll()\r\n\t\t\t.then((negotiations) =>\r\n\t\t\t\tnegotiations.forEach((negotiation) =>\r\n\t\t\t\t\tthis._negotiations.add(negotiation)\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t\t.catch((err) => (this._message.text = err));\r\n\t}\r\n\r\n\tasync add(event) {\r\n\t\ttry {\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tconst negotiation = this._createNegotiation();\r\n\r\n\t\t\tconst dao = await getNegotiationDAO();\r\n\t\t\tawait dao\r\n\t\t\t\t.add(negotiation)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tthis._negotiations.add(this._createNegotiation());\r\n\t\t\t\t\tthis._message.text = \"Trading successfully added\";\r\n\t\t\t\t\tthis._clearForm();\r\n\t\t\t\t})\r\n\t\t\t\t.catch((err) => (this._message.text = err));\r\n\t\t} catch (err) {\r\n\t\t\tconsole.log(err);\r\n\r\n\t\t\tif (err instanceof DateInvalidException) {\r\n\t\t\t\tthis._message.text = err.message;\r\n\t\t\t} else {\r\n\t\t\t\tthis._message.text =\r\n\t\t\t\t\t\"An unexpected error has occurred you. Contact support \";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t_clearForm() {\r\n\t\tthis._inputDate.value = \"\";\r\n\t\tthis._inputQuantity.value = 1;\r\n\t\tthis._inputValue.value = 0.0;\r\n\t\tthis._inputDate.focus();\r\n\t}\r\n\r\n\t_createNegotiation() {\r\n\t\treturn new Negotiation(\r\n\t\t\tDateConverter.toDate(this._inputDate.value),\r\n\t\t\tparseInt(this._inputQuantity.value),\r\n\t\t\tparseFloat(this._inputValue.value)\r\n\t\t);\r\n\t}\r\n\r\n\tasync delete() {\r\n\t\tconst dao = await getNegotiationDAO();\r\n\t\tawait dao\r\n\t\t\t.deleteAll()\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis._negotiations.clear();\r\n\t\t\t\tthis._message.text = \"Successfully deleted trades\";\r\n\t\t\t})\r\n\t\t\t.catch(\r\n\t\t\t\t() =>\r\n\t\t\t\t\t(this._message.text =\r\n\t\t\t\t\t\t\"Successfully deleted all negotiaions\")\r\n\t\t\t);\r\n\t}\r\n\r\n\tasync importNegotiations() {\r\n\t\ttry {\r\n\t\t\tconst object = await this._service.getNegotiationsByPeriod();\r\n\t\t\tobject\r\n\t\t\t\t.filter((newNegotiation) => \r\n\t\t\t\t\t!this._negotiations.toArray()\r\n\t\t\t\t\t\t.some((exists) => newNegotiation.equals(exists)))\r\n\t\t\t\t.forEach((negotiation) => this._negotiations.add(negotiation));\r\n\r\n\t\t\tthis._message.text = \"Successfully imported negotiations by period\";\r\n\t\t} catch (err) {\r\n\t\t\tthis._message.text = getExceptionMessage(err);\r\n\t\t}\r\n\t}\r\n}\r\n"]}